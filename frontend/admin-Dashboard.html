<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<style>
  /* Reset & Base */
  * { box-sizing: border-box; margin:0; padding:0; }
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f3f3f3; color: #333; }

  /* Layout */
  .container { display: flex; min-height: 100vh; }
  nav { width: 220px; background: #131921; color: white; display: flex; flex-direction: column; padding: 2rem 1rem; }
  nav h2 { margin-bottom: 2rem; font-size: 1.5rem; }
  nav a { color: white; text-decoration: none; padding: 0.5rem 0; margin-bottom: 0.5rem; border-radius: 4px; }
  nav a:hover { background: #232f3e; }
  main { flex: 1; padding: 2rem; }

  header { display:flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
  header h1 { font-size: 2rem; }
  header button { padding: 0.5rem 1rem; background: #ff9900; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
  header button:hover { background: #e68a00; }

  /* Forms */
  form { display: flex; flex-direction: column; gap: 1rem; margin-bottom: 2rem; }
  form input, form textarea { padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; width: 100%; }
  form button { width: 150px; background: #131921; color: white; border: none; border-radius: 4px; cursor: pointer; }
  form button:hover { background: #232f3e; }

  /* Tables */
  table { width: 100%; border-collapse: collapse; margin-bottom: 2rem; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
  th, td { padding: 0.75rem; border-bottom: 1px solid #ddd; text-align: left; }
  th { background: #232f3e; color: white; }
  tbody tr:hover { background: #f2f2f2; }

  h2 { margin-bottom: 1rem; color: #131921; }

  /* Button base styles */
  button {
    padding: 0.6rem 1.2rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    font-size: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }

  /* Logout button in sidebar */
  #logoutBtn {
    background: #ff9900;
    color: white;
    width: 100%;
    margin-top: auto;
  }
  #logoutBtn:hover {
    background: #e68a00;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    transform: translateY(-2px);
  }

  /* Add Product button in form */
  #addProductForm button {
    background: #131921;
    color: white;
    width: 180px;
  }
  #addProductForm button:hover {
    background: #232f3e;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    transform: translateY(-2px);
  }

  /* Responsive */
  @media(max-width:768px){
    .container { flex-direction: column; }
    nav { width: 100%; flex-direction: row; overflow-x: auto; padding:1rem; }
    nav h2 { display: none; }
    nav a { margin-right: 1rem; }
    main { padding:1rem; }
  }
</style>
</head>
<body>
<div class="container">
  <nav>
    <h2>Admin Panel</h2>
    <a href="#addProduct">Add Product</a>
    <a href="#ordersSection">Orders</a>
    <a href="#usersSection">Users</a>
    <button id="logoutBtn">Logout</button>
  </nav>
  <main>
    <header>
      <h1>Admin Dashboard</h1>
    </header>

    <section id="addProduct">
  <h2>Add Product</h2>
  <form id="addProductForm" enctype="multipart/form-data">
    <input type="text" id="title" placeholder="Title" required>
    <input type="number" id="price" placeholder="Price" required>
    <textarea id="description" placeholder="Description" required></textarea>
    <input type="file" id="image" accept="image/*">
    <button type="submit">Add Product</button>
  </form>
</section>

    <section id="ordersSection">
      <h2>Orders</h2>
      <table id="ordersTable">
        <thead><tr><th>User</th><th>Products</th><th>Total</th><th>Status</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="usersSection">
      <h2>Users</h2>
      <table id="usersTable">
        <thead><tr><th>Name</th><th>Email</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>
  </main>
</div>

<script>
// Get admin token
const token = localStorage.getItem('adminToken');
if (!token) window.location.href = 'adminLogin.html';

// ---------------- Logout ----------------
document.getElementById('logoutBtn').addEventListener('click', async () => {
  localStorage.removeItem('adminToken');
  window.location.href = 'adminLogin.html';
});

// ---------------- Add Product ----------------
document.getElementById('addProductForm').addEventListener('submit', async e => {
  e.preventDefault();

  const formData = new FormData();
  formData.append('title', document.getElementById('title').value);
  formData.append('price', document.getElementById('price').value);
  formData.append('description', document.getElementById('description').value);

  const imageFile = document.getElementById('image').files[0];
  if (imageFile) formData.append('image', imageFile);

  try {
    const res = await fetch('http://localhost:5000/api/admin/products', {
      method: 'POST',
      body: formData,
      headers: {
        'Authorization': 'Bearer ' + token
      }
    });

    const data = await res.json();
    if (res.ok) {
      alert('Product added successfully!');
      document.getElementById('addProductForm').reset();
      window.opener?.location.reload();
    } else {
      alert(data.message || 'Failed to add product.');
    }
  } catch (err) {
    console.error('Error adding product:', err);
    alert('Something went wrong. Please try again.');
  }
});

// ---------------- Load Orders ----------------
// ---------------- Load Orders ----------------
async function loadOrders() {
  try {
    const res = await fetch('http://localhost:5000/api/admin/orders', {
      method: 'GET',
      credentials: 'include' // <--- important!
    });

    if (!res.ok) throw new Error('Failed to fetch orders');

    const orders = await res.json();
    const tbody = document.querySelector('#ordersTable tbody');
    tbody.innerHTML = '';
    orders.forEach(o => {
      const products = o.items.map(p => p.product.title + ' x' + p.quantity).join(', ');
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${o.user.name}</td><td>${products}</td><td>$${o.totalPrice}</td><td>${o.status}</td>`;
      tbody.appendChild(tr);
    });
  } catch (err) {
    console.error('Error loading orders:', err);
    alert('Failed to load orders.');
  }
}


// ---------------- Load Users ----------------
// ---------------- Load Users ----------------
async function loadUsers() {
  try {
    const res = await fetch('http://localhost:5000/api/admin/users', {
      method: 'GET',
      credentials: 'include', // important to send session cookie
      headers: {
        'Authorization': 'Bearer ' + token // optional if using token-based auth
      }
    });

    if (!res.ok) throw new Error('Network response not ok');

    const users = await res.json();

    const tbody = document.querySelector('#usersTable tbody');
    tbody.innerHTML = '';
    users.forEach(u => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${u.name}</td><td>${u.email}</td>`;
      tbody.appendChild(tr);
    });
  } catch (err) {
    console.error('Error loading users:', err);
    alert('Failed to load users.');
  }
}

// Call functions
loadOrders();
loadUsers();
</script>





</body>
</html>
